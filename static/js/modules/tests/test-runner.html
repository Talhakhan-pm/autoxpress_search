<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Modules Test Runner</title>
  <style>
    body {
      font-family: monospace;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    h1, h2 {
      text-align: center;
    }
    .test-section {
      background-color: white;
      border-radius: 5px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .console-output {
      background-color: #1e1e1e;
      color: #dcdcdc;
      padding: 15px;
      border-radius: 5px;
      height: 300px;
      overflow-y: auto;
      margin-top: 10px;
      font-family: monospace;
      line-height: 1.5;
    }
    .success {
      color: #4CAF50;
    }
    .error {
      color: #f44336;
    }
    .warning {
      color: #ff9800;
    }
    button {
      padding: 8px 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background-color: #45a049;
    }
    .controls {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    .results-summary {
      text-align: center;
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Product Modules Test Runner</h1>
  
  <div class="controls">
    <button id="run-all-tests">Run All Tests</button>
    <button id="clear-console">Clear Console</button>
  </div>
  
  <div class="test-section">
    <h2>Test Console</h2>
    <div id="console-output" class="console-output"></div>
    <div id="results-summary" class="results-summary">No tests run yet</div>
  </div>

  <!-- Load the modules to test -->
  <script src="/static/js/modules/product-ranking.js"></script>
  <script src="/static/js/modules/product-badges.js"></script>
  <script src="/static/js/modules/product-renderer.js"></script>
  <script src="/static/js/modules/product-display-adapter.js"></script>
  
  <!-- Load the tests -->
  <script src="test-product-ranking.js"></script>
  <script src="test-product-badges.js"></script>
  <script src="test-product-renderer.js"></script>
  
  <script>
    // Console output interceptor
    const consoleOutput = document.getElementById('console-output');
    const resultsSummary = document.getElementById('results-summary');
    
    // Function to format console messages
    function formatLogMessage(args, type) {
      const timestamp = new Date().toLocaleTimeString();
      const prefix = `[${timestamp}] [${type.toUpperCase()}]: `;
      
      const formattedArgs = Array.from(args).map(arg => {
        if (typeof arg === 'object') {
          return JSON.stringify(arg, null, 2);
        }
        return String(arg);
      }).join(' ');
      
      return prefix + formattedArgs;
    }
    
    // Override console methods
    const originalConsole = {
      log: console.log,
      error: console.error,
      warn: console.warn
    };
    
    console.log = function() {
      // Call original console method
      originalConsole.log.apply(console, arguments);
      
      // Format and append to output
      const message = formatLogMessage(arguments, 'log');
      appendToConsole(message);
    };
    
    console.error = function() {
      originalConsole.error.apply(console, arguments);
      const message = formatLogMessage(arguments, 'error');
      appendToConsole(`<span class="error">${message}</span>`);
    };
    
    console.warn = function() {
      originalConsole.warn.apply(console, arguments);
      const message = formatLogMessage(arguments, 'warn');
      appendToConsole(`<span class="warning">${message}</span>`);
    };
    
    function appendToConsole(html) {
      consoleOutput.innerHTML += html + '<br>';
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
    }
    
    // Button event handlers
    document.getElementById('run-all-tests').addEventListener('click', runAllTests);
    document.getElementById('clear-console').addEventListener('click', function() {
      consoleOutput.innerHTML = '';
      resultsSummary.textContent = 'Console cleared';
    });
    
    function runAllTests() {
      consoleOutput.innerHTML = '';
      resultsSummary.textContent = 'Running tests...';
      
      appendToConsole('<span class="success">==========================================</span>');
      appendToConsole('<span class="success">RUNNING ALL MODULE TESTS</span>');
      appendToConsole('<span class="success">==========================================</span>');
      
      // Run tests for each module
      const testFunctions = [
        { name: 'ProductRanking', fn: window.testProductRanking, module: window.ProductRanking },
        { name: 'ProductBadges', fn: window.testProductBadges, module: window.ProductBadges },
        { name: 'ProductRenderer', fn: window.testProductRenderer, module: window.ProductRenderer }
      ];
      
      let passed = 0;
      let failed = 0;
      
      testFunctions.forEach(test => {
        if (test.module && typeof test.fn === 'function') {
          appendToConsole(`<span class="success">\n\n=== RUNNING ${test.name} TESTS ===</span>`);
          try {
            test.fn();
            passed++;
          } catch (e) {
            appendToConsole(`<span class="error">Test error: ${e.message}</span>`);
            failed++;
          }
        } else {
          appendToConsole(`<span class="error">\n\n=== SKIPPING ${test.name} TESTS (module not available) ===</span>`);
          failed++;
        }
      });
      
      appendToConsole('<span class="success">\n\n==========================================</span>');
      appendToConsole(`<span class="success">ALL TESTS COMPLETED</span>`);
      appendToConsole('<span class="success">==========================================</span>');
      
      resultsSummary.textContent = `Tests completed: ${passed} passed, ${failed} failed`;
      if (failed > 0) {
        resultsSummary.classList.add('error');
      } else {
        resultsSummary.classList.add('success');
      }
    }
  </script>
</body>
</html>
